# PhytoPort Pipeline Documentation üß¨

PhytoPort is a bioinformatics pipeline for **cross-species protein analysis**. It facilitates the extraction of orthologs, comparison of protein domains and phosphorylation sites, gene expression analysis, Protein-Protein Interaction (PPI) studies, and management of reference proteomes.

-----

## üõ†Ô∏è Pipeline Execution & Environment

The pipeline is primarily managed using **Snakemake** and distributed via **Apptainer** or **local installation**.

  * `README.md`: General overview and main entry point documentation.
  * `phytoport.sif`: The Singularity Image Format file for container execution.

### Shell Scripts

| Script | Description |
| :--- | :--- |
| `initialyse.sh` | **Main wrapper script** that provides a CLI. It prompts the user for the **comparison organism** (by name/UPID), **target proteins**, and **structure prediction targets**. It generates `config.yaml` and executes the pipeline via the `Snakefile`. |
| `entrypoint.sh` | Configures the **Docker entry point**. Handles container startup, volume mounting, and initiates the pipeline execution. |
| `build_phytoport.sh` | Checks for Docker, builds the PhytoPort Docker image, and ensures proper volume mounting and configuration. |
| `run_boltz2.sh` | Sets up and runs **Boltz-2** deep-learning protein structure predictions. Allows users to optionally restrict targets and updates `config.yaml` before launching the Snakemake workflow. |
| `input_utils.sh` | Utility functions for parsing, validating, and preparing input files for the pipeline. |

-----

## üíª Python Modules

The pipeline's core functionality is organized into modular Python packages: `fetch`, `extract`, `compare`, `summarize`, and `visualize`.

### üìÇ `fetch` (Data Retrieval)

| Script | Functionality |
| :--- | :--- |
| `proteomes.py` | Downloads **reference proteomes** from UniProt using organism name or UPID, supporting multiple organisms. |
| `proteins.py` | Fetches **FASTA files** for specified proteins from UniProt, preparing them for PPI analysis (e.g., creating pairwise FASTA files). |
| `geo_dataset.py` | Downloads the first **10X-style GEO files** for a given GSE or GSM ID, using FTP/HTTPS. |

### üîç `extract` (Ortholog and Tree Processing)

| Script | Functionality |
| :--- | :--- |
| `target_orthologs.py` | Extracts target orthologs from an **OrthoFinder TSV**. Matches genes by target symbols (supports wildcards like `SPA*`), organizes results, and outputs filtered TSV files. |
| `orthogroup_trees.py` | Extracts specific **orthogroup trees** from a Newick file based on a list of Orthogroup IDs. |

### ‚öñÔ∏è `compare` (Feature Comparison)

| Script | Functionality |
| :--- | :--- |
| `domains.py` | Compares predicted **domains/motifs** between two protein sequences from a TSV, identifying common and unique features. |
| `ps_sites.py` | Compares predicted **phosphorylation (PS) sites** between two protein sequences, identifying common/unique sites, with optional score filtering. |
| `structures.py` | (Implied by structure) Likely handles the comparison of protein structures, possibly generated by Boltz-2. |

### üìä `summarize` (Prediction Processing)

| Script | Functionality |
| :--- | :--- |
| `interproscan.py` | Summarizes raw **InterProScan** output for use in downstream analysis (e.g., domain comparison). |
| `musitedeep.py` | Summarizes **MusiteDeep** phosphorylation site predictions, including filtering by score cutoffs. |

### üñºÔ∏è `visualize` (Results Presentation)

| Script | Functionality |
| :--- | :--- |
| `ps_sites.py` | **Visualizes PS site scores** on protein sequences from a FASTA file using color and font size to represent per-residue score values. |
| `tree.py` | Renders a **Newick phylogenetic tree** with optional sequence and domain visualization. Automatically caps branch lengths to mitigate outlier skew. |

-----

## üß™ Testing

  * The pipeline has been validated through a **full case study execution**.

-----

## üìö External Dependencies & Resources

  * **OrthoFinder:** [Installation Guide](https://github.com/OrthoFinder/OrthoFinder?tab=readme-ov-file#installation)
  * **InterProScan:** [Documentation](https://interpro-documentation.readthedocs.io/en/latest/interproscan.html)
  * **MusiteDeep:** [GitHub Repository](https://github.com/duolinwang/MusiteDeep)
  * **Boltz-2:** [GitHub Repository](https://github.com/jwohlwend/boltz/tree/main) (Used for structure prediction)
  * **Seurat:** [Documentation](https://satijalab.org/seurat/) (Used for gene expression analysis, likely in conjunction with GEO data).

-----

## üöÄ Getting Started (Manual Steps)

1.  Ensure you are on a **Linux** or **WSL** command line.

2.  Ensure **Apptainer** is installed and running.

3.  Run the installation script to build the image:

    ```bash
    bash build_phytoport.sh
    ```

4.  Run the execution script to run the image (This mounts the correct directories üôÇ):

```bash
    bash run_phytoport.sh
```


